<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Tianchen Qian (t.qian@uci.edu), Shaolin Xiang, Zhaoxi Cheng" />

<meta name="date" content="2025-08-28" />

<title>Primary and Secondary Analysis for Micro-Randomized Trial (MRT): Proximal Outcomes</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Primary and Secondary Analysis for
Micro-Randomized Trial (MRT): Proximal Outcomes</h1>
<h4 class="author">Tianchen Qian (<a href="mailto:t.qian@uci.edu" class="email">t.qian@uci.edu</a>), Shaolin Xiang, Zhaoxi Cheng</h4>
<h4 class="date">2025-08-28</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <code>MRTAnalysis</code> package provides user-friendly functions
to conduct primary and secondary analyses for micro-randomized trial
(MRT), where the proximal outcomes are continuous or binary and the
intervention option is binary. For continuous proximal outcomes, the
estimated causal effects are on the additive scale. For binary proximal
outcomes, the estimated causal effects are on the log relative risk
scale. In particular, this package can be used to</p>
<ul>
<li>estimate the marginal proximal causal excursion effect</li>
<li>estimate the moderated proximal causal excursion effect, i.e., the
effect modification by time-fixed or time-varying covariates.</li>
</ul>
<p>MRT is an experimental design for optimizing mobile health
interventions. The marginal and the moderated causal excursion effects
are the quantities of interest in primary and secondary analyses for
MRT. In this tutorial we briefly review MRT and proximal causal
excursion effects, and illustrate the use of the estimators implemented
in this package for conducting primary and secondary analyses of MRT:
<code>wcls()</code> (weighted and centered least squares, for MRT with
continuous proximal outcomes) and <code>emee()</code> (estimator for
marginal excursion effect, for MRT with binary proximal outcomes).</p>
<p>In a separate tutorial, we will introduce the <code>dcee()</code>
function for estimating the distal causal excursion effect in MRT, i.e.,
the effect of the time-varying treatments on a distal outcome, measured
at the end of the study.</p>
</div>
<div id="data-structure-of-an-mrt" class="section level1">
<h1>Data Structure of an MRT</h1>
<p>In an MRT, each participant is repeatedly randomized among treatment
options many times throughout the trial. Suppose there are <span class="math inline">\(n\)</span> participants, and for the <span class="math inline">\(i\)</span>-th participant, they are enrolled in
the trial for <span class="math inline">\(m_i\)</span> decision points.
(In many MRT, the number of decision points <span class="math inline">\(m_i\)</span> is the same for all participants.
This package also automatically handles the setting where <span class="math inline">\(m_i\)</span> is different for different
participants, so we present the data structure in a more general
way.)</p>
<p>For the <span class="math inline">\(i\)</span>-th participant at the
<span class="math inline">\(t\)</span>-th decision point, we use the
triplet <span class="math inline">\((X_{it}, A_{it}, Y_{it})\)</span> to
denote the data collected, where</p>
<ul>
<li><span class="math inline">\(X_{it}\)</span> denotes the (vector of)
time-varying covariates.</li>
<li><span class="math inline">\(A_{it}\)</span> denotes the binary
treatment assignment; <span class="math inline">\(A_{it} = 1\)</span> if
randomized to intervention, <span class="math inline">\(A_{it} =
0\)</span> if randomized to no intervention.
<ul>
<li><span class="math inline">\(A_{it}\)</span> is randomized with
success probability <span class="math inline">\(p_{it}\)</span>. For
many MRTs the <span class="math inline">\(p_{it}\)</span> is a constant
throughout the trial for all participants (e.g., <span class="math inline">\(p_{it} = 0.6\)</span>), but for some MRTs <span class="math inline">\(p_{it}\)</span> may depend on the past
observations of the participant and thus is different for different
<span class="math inline">\((i,t)\)</span> combinations. This packages
handles both situations.</li>
</ul></li>
<li><span class="math inline">\(Y_{it}\)</span> denotes the proximal
outcome (continuous or binary) following <span class="math inline">\(A_{it}\)</span>.
<ul>
<li>In some literature, the proximal outcome following <span class="math inline">\(A_{it}\)</span> is written as <span class="math inline">\(Y_{i,t+1}\)</span>. We use <span class="math inline">\(Y_{it}\)</span> here because this aligns with the
<code>data.frame</code> input: each row in the <code>data.frame</code>
would correspond to <span class="math inline">\((X_{it}, A_{it},
Y_{it})\)</span> (and possibly other variables — see below) for a
specific <span class="math inline">\((i,t)\)</span> combination.</li>
</ul></li>
</ul>
<div id="availability" class="section level2">
<h2>Availability</h2>
<p>An MRT may include availability considerations. When it is
inappropriate or unethical to deliver interventions to an individual,
that individual is considered “unavailable”, and no intervention will be
delivered at that decision point so <span class="math inline">\(A_{it} =
0\)</span>.</p>
<p>Mathematically, we use <span class="math inline">\(I_{it}\)</span>
denotes the availability status of participant <span class="math inline">\(i\)</span> at decision point <span class="math inline">\(t\)</span>: <span class="math inline">\(I_{it} =
1\)</span> if available and <span class="math inline">\(I_{it} =
0\)</span> if unavailable. Temporal-wise, availability <span class="math inline">\(I_{it}\)</span> is determined before <span class="math inline">\(A_{it}\)</span>, and one can conceptualize it by
considering <span class="math inline">\(I_{it}\)</span> to be measured
at the same time as <span class="math inline">\(X_{it}\)</span>.</p>
</div>
</div>
<div id="prepare-your-data-set-for-analysis" class="section level1">
<h1>Prepare Your Data Set for Analysis</h1>
<p>To use any of the estimators in this package, you need to prepare
your data set as a <code>data.frame</code> in long format, meaning that
each row records observations from a decision point of a participant
(i.e., <span class="math inline">\((X_{it}, A_{it}, Y_{it})\)</span>
(and possibly other variables — see below) for a specific <span class="math inline">\((i,t)\)</span> combination). The
<code>data.frame</code> should be sorted so that consecutive rows should
be from adjacent decision points from the same participant. Furthermore,
the data set should contain the following columns:</p>
<ul>
<li>A user id column that distinguishes different participants.</li>
<li>An outcome column that contains the proximal outcome.</li>
<li>A treatment assignment column that contains the binary treatment
assignment <span class="math inline">\(A_{it}\)</span> (0 or 1, 1 being
the active treatment such as sending a push notification and 0 being the
control option such as not sending a push notification).</li>
<li>Columns that record baseline and time-varying covariates that will
be used as control variables and/or moderators in the analysis.</li>
</ul>
<p>The data set may also contain the following columns, depending on
your MRT:</p>
<ul>
<li>If in your MRT the randomization probability is not a constant
throughout, your data set should include a randomization probability
column that contains the randomization probability <span class="math inline">\(p_{it}\)</span>.</li>
<li>If your MRT has availability considerations, your data set should
include an availability column that contains the availability status
<span class="math inline">\(I_{it}\)</span>.</li>
<li>Optional: If in your MRT the randomization probability is not a
constant throughout, you may also provide an optional column that
contains the so-called numerator probability. A carefully constructed
numerator probability column may reduce the standard error of the causal
effect estimates. If you are not sure what this numerator probability
is, feel free to ignore it. See <span class="citation">Boruvka <em>and
others</em> (<a href="#ref-boruvka2018assessing">2018</a>)</span> and
<span class="citation">Qian <em>and others</em> (<a href="#ref-qian2021estimating">2021</a>)</span> for details.</li>
</ul>
</div>
<div id="causal-excursion-effect-estimation-for-mrt-with-continuous-outcomes" class="section level1">
<h1>Causal Excursion Effect Estimation for MRT with Continuous
Outcomes</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(MRTAnalysis)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>current_options <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="co"># save current options for restoring later</span></span></code></pre></div>
<div id="fully-marginal-causal-excursion-effect" class="section level2">
<h2>Fully Marginal Causal Excursion Effect</h2>
<p>The following code uses <code>wcls()</code> to estimate the fully
marginal causal excursion effect from a synthetic data set
<code>data_mimicHeartSteps</code> that mimics the HeartSteps V1 MRT
(<span class="citation">Klasnja <em>and others</em> (<a href="#ref-klasnja2015">2015</a>)</span>). This data set contains
observations for 37 individuals at 210 different time points. The data
set contains the following variables:</p>
<ul>
<li><code>userid</code>: id number of an individual.</li>
<li><code>time</code>: index of decision point.</li>
<li><code>day_in_study</code>: day in the study.</li>
<li><code>logstep_30min</code>: the proximal outcome, i.e., the step
count in the 30 minutes following the current decision point
(log-transformed).</li>
<li><code>logstep_30min_lag1</code>: the proximal outcome at the
previous decision point (lag-1 outcome), i.e., the step count in the 30
minutes following the previous decision point (log-transformed).</li>
<li><code>logstep_pre30min</code>: the step count in the 30 minutes
prior to the current decision point (log-transformed).</li>
<li><code>is_at_home_or_work</code>: whether the individual is at home
or work (=1) or at other locations (=0) at the current decision
point.</li>
<li><code>intervention</code>: whether the intervention is randomized to
be delivered (=1) or not (=0) at the current decision point; the
randomization probability is a constant 0.6 for this data set, mimicking
HeartSteps V1.</li>
<li><code>avail</code>: whether the individual is available (=1) or not
(=0) at the current decision point.</li>
</ul>
<p>A summary of <code>data_mimicHeartSteps</code> is as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">head</span>(data_mimicHeartSteps, <span class="dv">10</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt;    userid decision_point day_in_study logstep_30min logstep_30min_lag1</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; 1       1              1            0        2.3902             0.0000</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; 2       1              2            0       -0.6931             2.3902</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; 3       1              3            0        2.4647            -0.6931</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; 4       1              4            0        0.1207             2.4647</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; 5       1              5            0        0.8322             0.1207</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; 6       1              6            1        1.8450             0.8322</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; 7       1              7            1        4.6315             1.8450</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; 8       1              8            1        4.1929             4.6315</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; 9       1              9            1       -0.0344             4.1929</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; 10      1             10            1       -0.1495            -0.0344</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;    logstep_pre30min is_at_home_or_work intervention rand_prob avail</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; 1            -0.693                  1            0       0.6     0</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; 2             2.196                  1            0       0.6     1</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; 3             4.589                  1            1       0.6     1</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; 4             3.179                  1            1       0.6     1</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; 5             3.295                  0            0       0.6     0</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; 6             4.666                  1            0       0.6     0</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; 7             3.774                  0            0       0.6     1</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt; 8            -0.693                  1            1       0.6     1</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; 9            -0.693                  0            1       0.6     1</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; 10           -0.693                  1            1       0.6     1</span></span></code></pre></div>
<p>In the following function call of <code>wcls()</code>, we specify the
proximal outcome variable by <code>outcome = &quot;logstep_30min&quot;</code>. We
specify the treatment variable by
<code>treatment = &quot;intervention&quot;</code>. We specify the constant
randomization probability by <code>rand_prob = 0.6</code>. We specify
the fully marginal effect as the quantity to be estimated by setting
<code>moderator_formula = ~1</code>. We use
<code>logstep_pre30min</code> as a control variable by setting
<code>control_formula = ~logstep_pre30min</code>. We specify the
availability variable by <code>availability = avail</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">wcls</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="at">data =</span> data_mimicHeartSteps,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;userid&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;logstep_30min&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;intervention&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="at">rand_prob =</span> <span class="fl">0.6</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="at">moderator_formula =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="at">control_formula =</span> <span class="sc">~</span>logstep_pre30min,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="at">availability =</span> <span class="st">&quot;avail&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; Constant randomization probability 0.6 is used.</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; Constant numerator probability 0.5 is used.</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; wcls(data = data_mimicHeartSteps, id = &quot;userid&quot;, outcome = &quot;logstep_30min&quot;, </span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt;     treatment = &quot;intervention&quot;, rand_prob = 0.6, moderator_formula = ~1, </span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~logstep_pre30min, availability = &quot;avail&quot;)</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr Hotelling df1 df2 p-value</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.157   0.031   0.284 0.0622       6.4   1  34  0.0162</span></span></code></pre></div>
<p>The <code>summary()</code> function provides the estimated causal
excursion effect as well as the 95% confidence interval, standard error,
and p-value. The only row in the output
<code>$causal_excursion_effect</code> is named <code>(Intercept)</code>,
indicating that this is the fully marginal effect (like an intercept in
the causal effect model). In particular, the estimated marginal
excursion effect is 0.157, with 95% confidence interval (0.031, 0.284),
and p-value 0.016. The confidence interval and the p-value are based on
a small sample correction technique that is based on Hotelling’s T
distribution, so the Hotelling’s T statistic (<code>Hotelling</code>)
and the degrees of freedom (<code>df1</code> and <code>df2</code>) are
also printed. See <span class="citation">Boruvka <em>and others</em> (<a href="#ref-boruvka2018assessing">2018</a>)</span> for details on the
small sample correction.</p>
<p>One can include more control variables, e.g., by setting
<code>control_formula = ~logstep_pre30min + logstep_30min_lag1 + is_at_home_or_work</code>.
This is illustrated by the following code. Different choices of control
variables should lead to similar causal effect estimates, but better
control variables (i.e., those that are correlated with the proximal
outcome) usually decrease the standard error of the causal effect
estimates. This is the case here: the standard error of the marginal
causal excursion effect decreases slightly from 0.062 to 0.061 after we
included two additional control variables.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">wcls</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="at">data =</span> data_mimicHeartSteps,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;userid&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;logstep_30min&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;intervention&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="at">rand_prob =</span> <span class="fl">0.6</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">moderator_formula =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">control_formula =</span> <span class="sc">~</span> logstep_pre30min <span class="sc">+</span> logstep_30min_lag1 <span class="sc">+</span> is_at_home_or_work,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">availability =</span> <span class="st">&quot;avail&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; Constant randomization probability 0.6 is used.</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; Constant numerator probability 0.5 is used.</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; wcls(data = data_mimicHeartSteps, id = &quot;userid&quot;, outcome = &quot;logstep_30min&quot;, </span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt;     treatment = &quot;intervention&quot;, rand_prob = 0.6, moderator_formula = ~1, </span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~logstep_pre30min + logstep_30min_lag1 + </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt;         is_at_home_or_work, availability = &quot;avail&quot;)</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr Hotelling df1 df2 p-value</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.159  0.0351   0.283 0.0607      6.84   1  32  0.0135</span></span></code></pre></div>
<p>One can ask <code>summary()</code> to print out the fitted
coefficients for the control variables as well, by setting
<code>show_control_fit = TRUE</code>. This is illustrated by the
following code. However, we caution against interpreting the fitted
coefficients for the control variables, because these coefficients are
only interpretable when the control model is correctly specified, which
can rarely be true in an MRT setting.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">summary</span>(fit2, <span class="at">show_control_fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; Interpreting the fitted coefficients for control variables is not recommended.</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; wcls(data = data_mimicHeartSteps, id = &quot;userid&quot;, outcome = &quot;logstep_30min&quot;, </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;     treatment = &quot;intervention&quot;, rand_prob = 0.6, moderator_formula = ~1, </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~logstep_pre30min + logstep_30min_lag1 + </span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt;         is_at_home_or_work, availability = &quot;avail&quot;)</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr Hotelling df1 df2 p-value</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.159  0.0351   0.283 0.0607      6.84   1  32  0.0135</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; $control_variables</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt;                    Estimate 95% LCL 95% UCL StdErr Hotelling df1 df2  p-value</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; (Intercept)          1.8373  1.7222  1.9524 0.0565   1056.59   1  32 0.000000</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; logstep_pre30min     0.3400  0.2997  0.3803 0.0198    295.31   1  32 0.000000</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; logstep_30min_lag1   0.0399  0.0181  0.0618 0.0107     13.84   1  32 0.000764</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; is_at_home_or_work   0.1355  0.0263  0.2447 0.0536      6.39   1  32 0.016585</span></span></code></pre></div>
</div>
<div id="moderated-causal-excursion-effect" class="section level2">
<h2>Moderated Causal Excursion Effect</h2>
<p>The following code uses <code>wcls()</code> to estimate the causal
excursion effect moderated by the location of the individual,
<code>is_at_home_or_work</code>. This is achieved by setting
<code>moderator_formula = ~is_at_home_or_work</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">wcls</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="at">data =</span> data_mimicHeartSteps,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;userid&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;logstep_30min&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;intervention&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="at">rand_prob =</span> <span class="fl">0.6</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="at">moderator_formula =</span> <span class="sc">~</span>is_at_home_or_work,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    <span class="at">control_formula =</span> <span class="sc">~</span> logstep_pre30min <span class="sc">+</span> logstep_30min_lag1 <span class="sc">+</span> is_at_home_or_work,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    <span class="at">availability =</span> <span class="st">&quot;avail&quot;</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; Constant randomization probability 0.6 is used.</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; Constant numerator probability 0.5 is used.</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; wcls(data = data_mimicHeartSteps, id = &quot;userid&quot;, outcome = &quot;logstep_30min&quot;, </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt;     treatment = &quot;intervention&quot;, rand_prob = 0.6, moderator_formula = ~is_at_home_or_work, </span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~logstep_pre30min + logstep_30min_lag1 + </span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt;         is_at_home_or_work, availability = &quot;avail&quot;)</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt;                    Estimate 95% LCL 95% UCL StdErr Hotelling df1 df2 p-value</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; (Intercept)           0.109 -0.0288   0.247 0.0677     2.606   1  31   0.117</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; is_at_home_or_work    0.135 -0.1661   0.436 0.1475     0.835   1  31   0.368</span></span></code></pre></div>
<p>The moderated causal excursion effect is modeled as a linear form:
<span class="math inline">\(\beta_0 + \beta_1 \cdot
\text{is_at_home_or_work}\)</span>. The output
<code>$causal_excursion_effect</code> contains two rows, one for <span class="math inline">\(\beta_0\)</span> (with row name
<code>(Intercept)</code>) and the other for <span class="math inline">\(\beta_1\)</span> (with row name
<code>is_at_home_or_work</code>). Here, <span class="math inline">\(\beta_0\)</span> is the causal excursion effect
when the individual is not at home or work (estimate = 0.109, 95% CI =
(-0.029, 0.247), p = 0.117), and <span class="math inline">\(\beta_1\)</span> is the difference in the causal
excursion effects between when at home or work and when at other
locations (estimate = 0.135, 95% CI = (-0.166, 0.435), p = 0.368).</p>
<p>One can also ask <code>summary()</code> to calculate and print the
estimated coefficients for <span class="math inline">\(\beta_0 +
\beta_1\)</span>, the causal excursion effect when the individual is at
home or work, by using the <code>lincomb</code> optional argument. This
is illustrated by the following code. We set
<code>lincomb = c(1, 1)</code>, i.e., asks <code>summary()</code> to
print out <span class="math inline">\([1, 1] \times (\beta_0, \beta_1)^T
= \beta_0 + \beta_1\)</span>. The third row in
<code>$causal_excursion_effect</code>, named
<code>(Intercept) + is_at_home_or_work</code>, is the fitted result for
this <span class="math inline">\(\beta_0 + \beta_1\)</span> coefficient
combination.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">summary</span>(fit3, <span class="at">lincomb =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; wcls(data = data_mimicHeartSteps, id = &quot;userid&quot;, outcome = &quot;logstep_30min&quot;, </span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;     treatment = &quot;intervention&quot;, rand_prob = 0.6, moderator_formula = ~is_at_home_or_work, </span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~logstep_pre30min + logstep_30min_lag1 + </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;         is_at_home_or_work, availability = &quot;avail&quot;)</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;                                  Estimate 95% LCL 95% UCL StdErr Hotelling df1</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; (Intercept)                         0.109 -0.0288   0.247 0.0677     2.606   1</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; is_at_home_or_work                  0.135 -0.1661   0.436 0.1475     0.835   1</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; (Intercept) + is_at_home_or_work    0.244  0.0846   0.403 0.1260     3.753   2</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;                                  df2 p-value</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; (Intercept)                       31 0.11661</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; is_at_home_or_work                31 0.36787</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; (Intercept) + is_at_home_or_work  31 0.00187</span></span></code></pre></div>
<p>Based on the output, the causal excursion effect at home or work is
estimated to be 0.244, with 95% CI (0.085, 0.403) and p-value 0.002.</p>
</div>
</div>
<div id="causal-excursion-effect-estimation-for-mrt-with-binary-outcomes" class="section level1">
<h1>Causal Excursion Effect Estimation for MRT with Binary Outcomes</h1>
<p>The syntax of <code>emee()</code> is exactly the same as
<code>wcls()</code>. We illustrate the use of <code>emee()</code> below
for completeness.</p>
<div id="fully-marginal-causal-excursion-effect-1" class="section level2">
<h2>Fully Marginal Causal Excursion Effect</h2>
<p>The following code uses <code>emee()</code> to estimate the fully
marginal causal excursion effect from a synthetic data set
<code>data_binary</code>. This data set contains observations for 100
individuals at 30 different time points. The data set contains the
following variables:</p>
<ul>
<li><code>userid</code>: id number of an individual.</li>
<li><code>time</code>: index of decision point.</li>
<li><code>time_var1</code>: time-varying covariate 1 for illustration
purpose. Here it is defined as the “standardized time in study”, defined
as the current decision point index divided by the total number of
decision points.</li>
<li><code>time_var2</code>: time-varying covariate 2 for illustration
purpose. Here it is the indicator of “the second half of the study”,
defined as whether the current decision point index is greater than the
total number of decision points divided by 2.</li>
<li><code>Y</code>: the binary proximal outcome.</li>
<li><code>A</code>: whether the intervention is randomized to be
delivered (=1) or not (=0) at the current decision point;</li>
<li><code>rand_prob</code>: the randomization probability at each
decision point, which is not a constant over time.</li>
<li><code>avail</code>: whether the individual is available (=1) or not
(=0) at the current decision point.</li>
</ul>
<p>A summary of <code>data_binary</code> is as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">head</span>(data_binary, <span class="dv">30</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt;    userid time time_var1 time_var2 Y A avail rand_prob</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; 1       1    1    0.0333         0 0 0     1       0.3</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; 2       1    2    0.0667         0 0 1     1       0.5</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; 3       1    3    0.1000         0 0 0     1       0.7</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; 4       1    4    0.1333         0 1 0     0       0.3</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 5       1    5    0.1667         0 0 0     0       0.5</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 6       1    6    0.2000         0 0 0     0       0.7</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; 7       1    7    0.2333         0 0 0     1       0.3</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; 8       1    8    0.2667         0 0 1     1       0.5</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; 9       1    9    0.3000         0 0 0     1       0.7</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 10      1   10    0.3333         0 1 0     1       0.3</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; 11      1   11    0.3667         0 0 0     1       0.5</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 12      1   12    0.4000         0 0 1     1       0.7</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; 13      1   13    0.4333         0 1 0     1       0.3</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; 14      1   14    0.4667         0 0 0     1       0.5</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; 15      1   15    0.5000         0 1 1     1       0.7</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; 16      1   16    0.5333         1 0 0     1       0.3</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; 17      1   17    0.5667         1 1 1     1       0.5</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt; 18      1   18    0.6000         1 1 0     1       0.7</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt; 19      1   19    0.6333         1 1 0     1       0.3</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt; 20      1   20    0.6667         1 1 0     1       0.5</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; 21      1   21    0.7000         1 0 1     1       0.7</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; 22      1   22    0.7333         1 1 0     1       0.3</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt; 23      1   23    0.7667         1 1 1     1       0.5</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt; 24      1   24    0.8000         1 1 0     0       0.7</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt; 25      1   25    0.8333         1 1 1     1       0.3</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; 26      1   26    0.8667         1 1 1     1       0.5</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; 27      1   27    0.9000         1 1 0     1       0.7</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt; 28      1   28    0.9333         1 1 1     1       0.3</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt; 29      1   29    0.9667         1 0 1     1       0.5</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; 30      1   30    1.0000         1 1 1     1       0.7</span></span></code></pre></div>
<p>In the following function call of <code>emee()</code>, we specify the
proximal outcome variable by <code>outcome = Y</code>. We specify the
treatment variable by <code>treatment = A</code>. We specify the
randomization probability by <code>rand_prob = rand_prob</code> (the
first <code>rand_prob</code> is an argument of <code>emee()</code>; the
second <code>rand_prob</code> is a column in <code>data_binary</code>).
We specify the fully marginal effect as the quantity to be estimated by
setting <code>moderator_formula = ~1</code>. We use
<code>time_var1</code> and <code>time_var2</code> as control variables
by setting <code>control_formula = ~ time_var1 + time_var2</code>. We
specify the availability variable by
<code>availability = avail</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">emee</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="at">data =</span> data_binary,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;userid&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">rand_prob =</span> <span class="st">&quot;rand_prob&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="at">moderator_formula =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="at">control_formula =</span> <span class="sc">~</span> time_var1 <span class="sc">+</span> time_var2,</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="at">availability =</span> <span class="st">&quot;avail&quot;</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; Constant numerator probability 0.5 is used.</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="fu">summary</span>(fit4)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; emee(data = data_binary, id = &quot;userid&quot;, outcome = &quot;Y&quot;, treatment = &quot;A&quot;, </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;     rand_prob = &quot;rand_prob&quot;, moderator_formula = ~1, control_formula = ~time_var1 + </span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;         time_var2, availability = &quot;avail&quot;)</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr t_value df  p-value</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.341   0.241    0.44   0.05    6.81 96 8.54e-10</span></span></code></pre></div>
<p>The <code>summary()</code> function provides the estimated causal
excursion effect as well as the 95% confidence interval, standard error,
and p-value. The only row in the output
<code>$causal_excursion_effect</code> is named <code>(Intercept)</code>,
indicating that this is the fully marginal effect (like an intercept in
the causal effect model). In particular, the estimated marginal
excursion effect is 0.341 (on the log relative risk scale), with 95%
confidence interval (0.241, 0.44), and p-value<span class="math inline">\(&lt;0.001\)</span>.</p>
<p>One can ask <code>summary()</code> to print out the fitted
coefficients for the control variables as well, by setting
<code>show_control_fit = TRUE</code>. This is illustrated by the
following code. However, we caution against interpreting the fitted
coefficients for the control variables, because these coefficients are
only interpretable when the control model is correctly specified, which
can rarely be true in an MRT setting.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">summary</span>(fit4, <span class="at">show_control_fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; Interpreting the fitted coefficients for control variables is not recommended.</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; emee(data = data_binary, id = &quot;userid&quot;, outcome = &quot;Y&quot;, treatment = &quot;A&quot;, </span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;     rand_prob = &quot;rand_prob&quot;, moderator_formula = ~1, control_formula = ~time_var1 + </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt;         time_var2, availability = &quot;avail&quot;)</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr t_value df  p-value</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.341   0.241    0.44   0.05    6.81 96 8.54e-10</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; $control_variables</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr t_value df  p-value</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; (Intercept)   -1.580 -1.7154   -1.45  0.068  -23.26 96 3.13e-41</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; time_var1      0.672  0.2878    1.06  0.194    3.47 96 7.76e-04</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; time_var2      0.248  0.0268    0.47  0.112    2.22 96 2.84e-02</span></span></code></pre></div>
</div>
<div id="moderated-causal-excursion-effect-1" class="section level2">
<h2>Moderated Causal Excursion Effect</h2>
<p>The following code uses <code>emee()</code> to estimate the causal
excursion effect moderated by <code>time_var1</code>. This is achieved
by setting <code>moderator_formula = ~time_var1</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">emee</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="at">data =</span> data_binary,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;userid&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">rand_prob =</span> <span class="st">&quot;rand_prob&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="at">moderator_formula =</span> <span class="sc">~</span>time_var1,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="at">control_formula =</span> <span class="sc">~</span> time_var1 <span class="sc">+</span> time_var2,</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="at">availability =</span> <span class="st">&quot;avail&quot;</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; Constant numerator probability 0.5 is used.</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="fu">summary</span>(fit5)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; emee(data = data_binary, id = &quot;userid&quot;, outcome = &quot;Y&quot;, treatment = &quot;A&quot;, </span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt;     rand_prob = &quot;rand_prob&quot;, moderator_formula = ~time_var1, </span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~time_var1 + time_var2, availability = &quot;avail&quot;)</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt;             Estimate 95% LCL 95% UCL StdErr t_value df p-value</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; (Intercept)   0.0811  -0.180   0.342  0.132   0.616 95  0.5391</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; time_var1     0.4293   0.051   0.808  0.191   2.253 95  0.0266</span></span></code></pre></div>
<p>The moderated causal excursion effect is modeled as a linear form:
<span class="math inline">\(\beta_0 + \beta_1 \cdot
\text{time_var1}\)</span>. The output
<code>$causal_excursion_effect</code> contains two rows, one for <span class="math inline">\(\beta_0\)</span> (with row name
<code>(Intercept)</code>) and the other for <span class="math inline">\(\beta_1\)</span> (with row name
<code>time_var1</code>). Here, <span class="math inline">\(\beta_0\)</span> is the causal excursion effect
when <code>time_var1</code><span class="math inline">\(=0\)</span>
(estimate = 0.081, 95% CI = (-0.180, 0.342), p = 0.54), and <span class="math inline">\(\beta_1\)</span> is the slope of
<code>time_var1</code> in the causal excursion effect model (estimate =
0.429, 95% CI = (0.051, 0.808), p = 0.03).</p>
<p>One can also ask <code>summary()</code> to calculate and print the
linear combination of coefficients and their confidence interval,
standard error, and p-value, by using the <code>lincomb</code> optional
argument. The following code sets
<code>lincomb = rbind(c(1, 0.0333), c(1, 0.5), c(1, 1))</code>, i.e.,
asks <code>summary()</code> to print out the estimates for <span class="math display">\[
\begin{bmatrix}1 &amp; 0.0333\\
1 &amp; 0.5\\
1 &amp; 1
\end{bmatrix}\times\begin{bmatrix}\beta_{0}\\
\beta_{1}
\end{bmatrix}=\begin{bmatrix}\beta_{0}+0.0333\beta_{1}\\
\beta_{0}+0.5\beta_{1}\\
\beta_{0}+\beta_{1}
\end{bmatrix}.
\]</span> Because <span class="math inline">\(\beta_1\)</span> is the
slope of <code>time_var1</code>, which is a scaled version of decision
time index that starts at 0.0333 and ends at 1, <span class="math inline">\(\beta_0 + 0.0333\beta_1\)</span>, <span class="math inline">\(\beta_0 + 0.5\beta_1\)</span> and <span class="math inline">\(\beta_0 + \beta_1\)</span> are the causal
excursion effects at the beginning of the study, mid-way during the
study, and at the end of the study, respectively. The 3rd to 5th rows in
<code>$causal_excursion_effect</code> show these results. Note that the
interpretation is under the assumption that the causal excursion effect
changes linearly over time.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">summary</span>(fit5, <span class="at">lincomb =</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.0333</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; emee(data = data_binary, id = &quot;userid&quot;, outcome = &quot;Y&quot;, treatment = &quot;A&quot;, </span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt;     rand_prob = &quot;rand_prob&quot;, moderator_formula = ~time_var1, </span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;     control_formula = ~time_var1 + time_var2, availability = &quot;avail&quot;)</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; $causal_excursion_effect</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt;                                Estimate 95% LCL 95% UCL StdErr t_value df</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; (Intercept)                      0.0811  -0.180   0.342 0.1316   0.616 95</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; time_var1                        0.4293   0.051   0.808 0.1905   2.253 95</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; (Intercept) + 0.0333*time_var1   0.0954  -0.154   0.345 0.1258   0.759 95</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; (Intercept) + 0.5*time_var1      0.2958   0.183   0.409 0.0569   5.202 95</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; (Intercept) + time_var1          0.5105   0.341   0.680 0.0854   5.978 95</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;                                 p-value</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; (Intercept)                    5.39e-01</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; time_var1                      2.66e-02</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; (Intercept) + 0.0333*time_var1 4.50e-01</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; (Intercept) + 0.5*time_var1    1.13e-06</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; (Intercept) + time_var1        3.93e-08</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">options</span>(current_options) <span class="co"># restore old options</span></span></code></pre></div>
</div>
</div>
<div id="bibliography" class="section level1">
<h1>Bibliography</h1>
<p>Below are some references:</p>
<ul>
<li>A review of MRT design, the causal excursion effect for continuous
outcome, and the weighted and centered least squares (WCLS) method:
<span class="citation">Qian <em>and others</em> (<a href="#ref-qian2022microrandomized">2022</a>)</span></li>
<li>The original statistical paper on MRT with continuous outcome, which
proposed the causal excursion effect and the WCLS method: <span class="citation">Boruvka <em>and others</em> (<a href="#ref-boruvka2018assessing">2018</a>)</span></li>
<li>The original statistical paper on MRT with binary outcome, which
proposed the causal excursion effect for binary outcome and the
estimator for marginal excursion effect (EMEE) method: <span class="citation">Qian <em>and others</em> (<a href="#ref-qian2021estimating">2021</a>)</span></li>
</ul>
</div>
<div id="reference" class="section level1 unnumbered">
<h1 class="unnumbered">Reference</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-boruvka2018assessing" class="csl-entry">
Boruvka, A., Almirall, D., Witkiewitz, K. and Murphy, S. A. (2018).
Assessing time-varying causal effect moderation in mobile health.
<em>Journal of the American Statistical Association</em>
<strong>113</strong>, 1112–1121.
</div>
<div id="ref-klasnja2015" class="csl-entry">
Klasnja, P., Hekler, E. B., Shiffman, S., Boruvka, A., Almirall, D.,
Tewari, A. and Murphy, S. A. (2015). Microrandomized trials: An
experimental design for developing just-in-time adaptive interventions.
<em>Health Psychology</em> <strong>34</strong>, 1220.
</div>
<div id="ref-qian2022microrandomized" class="csl-entry">
Qian, T., Walton, A. E., Collins, L. M., Klasnja, P., Lanza, S. T.,
Nahum-Shani, I., Rabbi, M., Russell, M. A., Walton, M. A., Yoo, H., et
al. (2022). The microrandomized trial for developing digital
interventions: Experimental design and data analysis considerations.
<em>Psychological Methods</em>.
</div>
<div id="ref-qian2021estimating" class="csl-entry">
Qian, T., Yoo, H., Klasnja, P., Almirall, D. and Murphy, S. A. (2021).
Estimating time-varying causal excursion effects in mobile health with
binary outcomes. <em>Biometrika</em> <strong>108</strong>, 507–527.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
